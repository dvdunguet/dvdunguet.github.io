(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{1141:function(t,e){},1142:function(t,e,n){var content=n(1157);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(129).default)("1b7833da",content,!0,{sourceMap:!1})},1154:function(t,e){},1155:function(t,e){},1156:function(t,e,n){"use strict";n(1142)},1157:function(t,e,n){var o=n(128)(!1);o.push([t.i,".ant-upload-drag-icon{margin-bottom:0!important}.ant-upload.ant-upload-drag .ant-upload{padding:0}.ant-col{padding:5px}.mgt{margin-top:12px}.row-color-accounted{background-color:gold}.row-color-no-stan{background-color:#ff4d4f}",""]),t.exports=o},1161:function(t,e,n){"use strict";n.r(e);n(78),n(67),n(133),n(134);var o=n(61),r=n(1160),c=(n(77),n(602),n(135),n(79),n(1144),n(102),n(103),n(1145),n(54),n(3)),l=n.n(c),d=n(1149),m=n.n(d);function f(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}function h(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?f(Object(source),!0).forEach((function(e){Object(o.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):f(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var v=[{title:"STT",dataIndex:"key",key:"key",sorter:function(a,b){return a.key-b.key}},{title:"Số thẻ",dataIndex:"cardnumber",key:"cardnumber"},{title:"STAN",dataIndex:"stan",key:"stan"},{title:"Số tiền",key:"amount",scopedSlots:{customRender:"amount"},sorter:function(a,b){return a.amount-b.amount},sortDirections:["descend","ascend"]},{title:"Thời gian",dataIndex:"time",key:"time",sorter:function(a,b){return l()(a.time,"DD-MM-YYYY HH:mm:ss")-l()(b.time,"DD-MM-YYYY HH:mm:ss")},sortDirections:["descend","ascend"]}],y=[{title:"STT",key:"key",scopedSlots:{customRender:"key"}},{title:"Chưa hạch toán",key:"notAccounted",scopedSlots:{customRender:"notAccounted"}},{title:"Đã hạch toán",key:"accounted",scopedSlots:{customRender:"accounted"}},{title:"Tổng",key:"total",scopedSlots:{customRender:"total"}},{title:"Không có STAN",key:"noStan",scopedSlots:{customRender:"noStan"}},{title:"Hành động",dataIndex:"operation",scopedSlots:{customRender:"operation"}}],_={data:function(){return{config:{dateTime:1,operation:2,amount:4,result:6,cardNumber:7,stan:9,reversalId:10},uploadFileConfig:{showRemoveIcon:!1},timePicker:{format:"h:mm"},data:{fimi:"",ipcas:""},count:{all:0,notAccounted:0,accounted:0,noStan:0},amount:{all:0,notAccounted:0,accounted:0,noStan:0},table:{banknet:{columns:v,data:[]},history:{columns:y,data:[]}},value:{fimi:0,ipcas:0},modalVisible:!1,modalVisibleHistory:!1,checktime:null,fileList:[],fileXlsCount:1,maxHistoryAmount:50,moment:l.a}},computed:{totalCountBanknet:function(){return this.table.history.data.reduce((function(a,b){return a+(b.count.notAccounted||0)}),0)},totalAmountBanknet:function(){return this.table.history.data.reduce((function(a,b){return a+(b.amount.notAccounted||0)}),0)},concludeBanknet:function(){var t=this.table.history.data.reduce((function(a,b){return a+(b.amount.notAccounted||0)}),0),e=this.value.fimi-(this.value.ipcas-t);return e>0?"Thừa quỹ":0===e?"Cân quỹ":"Thiếu quỹ"},numberConcludeBanknet:function(){var t=this.table.history.data.reduce((function(a,b){return a+(b.amount.notAccounted||0)}),0);return Math.abs(this.value.fimi-(this.value.ipcas-t))}},mounted:function(){var data=this.data;localStorage.config&&(this.config=JSON.parse(localStorage.config)),localStorage.ipcas&&(data.ipcas=localStorage.ipcas),localStorage.fileList&&(this.fileList=JSON.parse(localStorage.fileList)),localStorage.history&&(this.table.history.data=JSON.parse(localStorage.history)),localStorage.value&&(this.value=JSON.parse(localStorage.value)),localStorage.checktime&&(this.checktime=l()(parseInt(localStorage.checktime)))},methods:{onChangeValue:function(){localStorage.value=JSON.stringify(this.value)},setModalVisible:function(t){this.modalVisible=t,!t&&localStorage.config&&(this.config=JSON.parse(localStorage.config))},setModalVisibleHistory:function(t){this.modalVisibleHistory=t},saveDataModal:function(){localStorage.config=JSON.stringify(this.config),this.modalVisible=!1,this.$message.success("Cập nhật thành công")},onChange:function(t){if(localStorage.checktime=(null==t?void 0:t.valueOf())||"",localStorage.ipcasTemp){var e=t?t._d.getTime():Date.now(),n=JSON.parse(localStorage.ipcasTemp),o=[];n.forEach((function(t,n){new Date(t.trtime).getTime()<=e&&o.push(t.remark)})),o=(o=o.filter((function(t){return/\S/.test(t)&&t.trim().replace(/\s+/g," ").split(" ").length>1}))).join("\n"),this.data.ipcas=o,localStorage.ipcas=o}},onDelete:function(t){var e=Object(r.a)(this.table.history.data);this.table.history.data=e.filter((function(e){return e.key!==t}))},onDeleteAll:function(){var table=this.table;this.setModalVisibleHistory(!1);["history","fimi","ipcas","fileList","ipcasTemp","checktime","value"].forEach((function(t){return localStorage.removeItem(t)})),this.checktime=null,this.fileList=[],this.value={fimi:0,ipcas:0},this.data={fimi:0,ipcas:0},this.count={all:0,notAccounted:0,accounted:0,noStan:0},this.amount={all:0,notAccounted:0,accounted:0,noStan:0},table.banknet.data=[],table.history.data=[]},onViewHistory:function(t){this.data.fimi=t.fimi,this.handleCheck(!0),this.modalVisibleHistory=!1},convertDataIpcas:function(){var data=this.data;return(data.ipcas?data.ipcas.split(/\n/):[]).map((function(t){var e=t.trim().replace(/\s+/g," ").split(" ");return"".concat(e[0].trim(),"-").concat(e[1].trim().substr(e[1].trim().length-4))}))},processDataFimi:function(t){var e=this.config,n=Math.max.apply(Math,Object(r.a)(Object.values(e))),o=t.split(/\n/);return(o=o.map((function(t){if(/\S/.test(t)){var o=t.split("\t");if(o.length>=n&&"Approved"===(o=o.map((function(t,n){return n===e.dateTime?t.trim():t.replace(/\s/g,"")})))[e.result]&&"Withdrawal"===o[e.operation]&&""===o[e.reversalId])return o[e.cardNumber]=o[e.cardNumber].split("-")[0].trim(),o}return null}))).filter((function(t){return null!==t}))},compareFimiAndIpcas:function(t,e,n){var o=this.config,r={all:0,accounted:0,notAccounted:0,noStan:0},c={all:0,accounted:0,notAccounted:0,noStan:0},l=[];return r.all=t.length,t.forEach((function(t,d){c.all+=parseInt(t[o.amount]);var m=t[o.cardNumber],f=parseInt(t[o.amount]),h={key:d+1,cardnumber:m,stan:t[o.stan],amount:f,time:t[o.dateTime],color:!1,noStan:!1};h.stan||(r.noStan++,c.noStan+=f-f%5e4,h.noStan=!0),e.includes("".concat(t[o.stan],"-").concat(m.substr(m.length-4)))?(r.accounted++,c.accounted+=f-f%5e4,h.color=!0):(r.notAccounted++,c.notAccounted+=f-f%5e4),n&&l.push(h)})),{count:r,amount:c,tableBanknetData:l}},handleCheck:function(t){var data=this.data,table=this.table,e=this.maxHistoryAmount,n=this.convertDataIpcas(),o=this.processDataFimi(data.fimi),r=this.compareFimiAndIpcas(o,n,!0);this.count=r.count,this.amount=r.amount,table.banknet.data=r.tableBanknetData,t||(table.history.data.unshift({key:Date.now(),count:h({},r.count),amount:h({},r.amount),fimi:data.fimi}),table.history.data.length>e&&(table.history.data=table.history.data.splice(0,e)),localStorage.history=JSON.stringify(table.history.data))},handleBeforeUpload:function(t){var e=this,data=this.data,n=this.checktime,o=n?n._d.getTime():Date.now(),c=t.uid.split("-"),l=parseInt(c[c.length-1]),d=[];2!==l&&l===this.fileXlsCount+1||(this.fileList=[],data.ipcas=""),this.fileXlsCount=l,this.fileList=[].concat(Object(r.a)(this.fileList),[t]);var f=new FileReader;return f.onload=function(t){var n=new Uint8Array(t.target.result),r=m.a.read(n,{type:"array"}),c=[];r.SheetNames.forEach((function(t){m.a.utils.sheet_to_json(r.Sheets[t],{raw:!1}).forEach((function(t){t.remark&&t.trtime&&(c.push({remark:t.remark,trtime:t.trtime}),new Date(t.trtime).getTime()<=o&&d.push(t.remark))}))})),d=(d=d.filter((function(t){return/\S/.test(t)&&t.trim().replace(/\s+/g," ").split(" ").length>1}))).join("\n"),data.ipcas+=d,localStorage.ipcas=data.ipcas,localStorage.ipcasTemp=JSON.stringify(c);var l=e.fileList.map((function(t){return{uid:t.uid,name:t.name}}));localStorage.fileList=JSON.stringify(l)},f.readAsArrayBuffer(t),!1},changeIpcasData:function(){var t=this,e=Object(r.a)(this.table.history.data),n=[];if(e.length>0){var o=this.convertDataIpcas();e.forEach((function(e,r){var c=t.processDataFimi(e.fimi),l=t.compareFimiAndIpcas(c,o,!1);n.unshift({key:e.key,count:h({},l.count),amount:h({},l.amount),fimi:e.fimi})})),this.table.history.data=n,localStorage.history=JSON.stringify(n)}this.$message.success("Cập nhật tổng Banknet thành công")}}},k=(n(1156),n(95)),component=Object(k.a)(_,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container"},[n("a-row",[n("a-col",{attrs:{md:11}},[n("span",{on:{click:function(){return t.setModalVisibleHistory(!0)}}},[n("a-icon",{staticClass:"mgt",attrs:{type:"history"},on:{click:function(){return t.setModalVisibleHistory(!0)}}}),t._v("\n        Tổng banknet:\n        "),n("a-tag",{attrs:{color:"red"}},[t._v("\n          "+t._s(t.totalAmountBanknet.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" đ")+"\n        ")]),t._v(" "),n("a-divider",{attrs:{type:"vertical"}}),t._v(" "),n("a-tag",{attrs:{color:"blue"}},[t._v("\n          "+t._s(t.totalCountBanknet)+"\n        ")]),t._v(" "),n("a-divider",{attrs:{type:"vertical"}}),t._v(" "),n("a-tag",{attrs:{color:"#108ee9"}},[t._v("\n          "+t._s(t.concludeBanknet)+"\n        ")]),t._v(" "),n("a-divider",{attrs:{type:"vertical"}}),t._v(" "),n("a-tag",{attrs:{color:"#f50"}},[t._v("\n          "+t._s(t.numberConcludeBanknet.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" đ")+"\n        ")])],1),t._v(" "),n("div",[n("a-button",{staticClass:"mgt",attrs:{type:"primary",ghost:""},on:{click:function(){return t.handleCheck(!1)}}},[t._v("\n          Kiểm tra\n        ")])],1),t._v(" "),n("a-modal",{attrs:{title:"Lịch sử chấm Banknet",visible:t.modalVisibleHistory,width:1e3},on:{cancel:function(){return t.setModalVisibleHistory(!1)}}},[n("template",{slot:"footer"},[n("a-button",{key:"submit",attrs:{type:"primary"},on:{click:function(){return t.setModalVisibleHistory(!1)}}},[t._v("\n            Đóng\n          ")])],1),t._v(" "),n("a-table",{attrs:{columns:t.table.history.columns,"data-source":t.table.history.data,pagination:!1},scopedSlots:t._u([{key:"key",fn:function(text,e,o){return n("a",{},[t._v(" "+t._s(o+1))])}},{key:"notAccounted",fn:function(text,e){return n("span",{},[n("a-tag",{attrs:{color:"blue"}},[t._v("\n              "+t._s(e.count.notAccounted)+"\n            ")]),t._v(" "),n("a-divider",{attrs:{type:"vertical"}}),t._v(" "),n("a-tag",{attrs:{color:"red"}},[t._v("\n              "+t._s(e.amount.notAccounted.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" đ")+"\n            ")])],1)}},{key:"operation",fn:function(text,e){return[n("a-icon",{style:{fontSize:"20px",color:"#1890ff"},attrs:{type:"eye"},on:{click:function(){return t.onViewHistory(e)}}}),t._v(" "),n("a-divider",{attrs:{type:"vertical"}}),t._v(" "),t.table.history.data.length?n("a-popconfirm",{attrs:{title:"Bạn có chắc chắn xoá không?"},on:{confirm:function(){return t.onDelete(e.key)}}},[n("a",{attrs:{href:"javascript:;"}},[n("a-icon",{style:{fontSize:"20px",color:"red"},attrs:{type:"delete",theme:"filled"}})],1)]):t._e()]}},{key:"accounted",fn:function(text,e){return n("span",{},[n("a-tag",{attrs:{color:"blue"}},[t._v("\n              "+t._s(e.count.accounted)+"\n            ")]),t._v(" "),n("a-divider",{attrs:{type:"vertical"}}),t._v(" "),n("a-tag",{attrs:{color:"red"}},[t._v("\n              "+t._s(e.amount.accounted.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" đ")+"\n            ")])],1)}},{key:"total",fn:function(text,e){return n("span",{},[n("a-tag",{attrs:{color:"blue"}},[t._v("\n              "+t._s(e.count.all)+"\n            ")]),t._v(" "),n("a-divider",{attrs:{type:"vertical"}}),t._v(" "),n("a-tag",{attrs:{color:"red"}},[t._v("\n              "+t._s(e.amount.all.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" đ")+"\n            ")])],1)}},{key:"noStan",fn:function(text,e){return n("span",{},[n("a-tag",{attrs:{color:"blue"}},[t._v("\n              "+t._s(e.count.noStan)+"\n            ")]),t._v(" "),n("a-divider",{attrs:{type:"vertical"}}),t._v(" "),n("a-tag",{attrs:{color:"red"}},[t._v("\n              "+t._s(e.amount.noStan.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" đ")+"\n            ")])],1)}}])}),t._v(" "),n("span",[t._v("Tổng banknet: ")]),t._v(" "),n("a-tag",{attrs:{color:"blue"}},[t._v("\n          "+t._s(t.totalCountBanknet)+"\n        ")]),t._v(" "),n("a-divider",{attrs:{type:"vertical"}}),t._v(" "),n("a-tag",{attrs:{color:"red"}},[t._v("\n          "+t._s(t.totalAmountBanknet.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" đ")+"\n        ")])],2)],1),t._v(" "),n("a-col",{attrs:{md:1}},[n("a-icon",{staticClass:"mgt",style:{fontSize:"16px",color:"#08c"},attrs:{type:"setting"},on:{click:function(){return t.setModalVisible(!0)}}}),t._v(" "),n("a-modal",{attrs:{title:"Cài đặt vị trí trên Fimi",visible:t.modalVisible},on:{cancel:function(){return t.setModalVisible(!1)}}},[n("template",{slot:"footer"},[n("a-button",{key:"back",on:{click:function(){return t.setModalVisible(!1)}}},[t._v("\n            Huỷ\n          ")]),t._v(" "),n("a-button",{key:"submit",attrs:{type:"primary"},on:{click:t.saveDataModal}},[t._v("\n            Lưu\n          ")])],1),t._v(" "),n("a-form",{attrs:{layout:"horizontal"}},[n("a-form-item",{attrs:{label:"Date Time","label-col":{span:8},"wrapper-col":{span:14}}},[n("a-input-number",{attrs:{min:0,max:50},model:{value:t.config.dateTime,callback:function(e){t.$set(t.config,"dateTime",e)},expression:"config.dateTime"}})],1),t._v(" "),n("a-form-item",{attrs:{label:"Operation","label-col":{span:8},"wrapper-col":{span:14}}},[n("a-input-number",{attrs:{min:0,max:50},model:{value:t.config.operation,callback:function(e){t.$set(t.config,"operation",e)},expression:"config.operation"}})],1),t._v(" "),n("a-form-item",{attrs:{label:"Amount","label-col":{span:8},"wrapper-col":{span:14}}},[n("a-input-number",{attrs:{min:0,max:50},model:{value:t.config.amount,callback:function(e){t.$set(t.config,"amount",e)},expression:"config.amount"}})],1),t._v(" "),n("a-form-item",{attrs:{label:"Result","label-col":{span:8},"wrapper-col":{span:14}}},[n("a-input-number",{attrs:{min:0,max:50},model:{value:t.config.result,callback:function(e){t.$set(t.config,"result",e)},expression:"config.result"}})],1),t._v(" "),n("a-form-item",{attrs:{label:"Card Number","label-col":{span:8},"wrapper-col":{span:14}}},[n("a-input-number",{attrs:{min:0,max:50},model:{value:t.config.cardNumber,callback:function(e){t.$set(t.config,"cardNumber",e)},expression:"config.cardNumber"}})],1),t._v(" "),n("a-form-item",{attrs:{label:"Stan","label-col":{span:8},"wrapper-col":{span:14}}},[n("a-input-number",{attrs:{min:0,max:50},model:{value:t.config.stan,callback:function(e){t.$set(t.config,"stan",e)},expression:"config.stan"}})],1),t._v(" "),n("a-form-item",{attrs:{label:"Reversal ID","label-col":{span:8},"wrapper-col":{span:14}}},[n("a-input-number",{attrs:{min:0,max:50},model:{value:t.config.reversalId,callback:function(e){t.$set(t.config,"reversalId",e)},expression:"config.reversalId"}})],1)],1)],2)],1),t._v(" "),n("a-col",{attrs:{md:5}},[n("a-date-picker",{attrs:{"show-time":t.timePicker,format:"DD/MM/YYYY HH:mm",placeholder:"Giờ chốt số dư IPCAS",size:"large"},on:{change:t.onChange},model:{value:t.checktime,callback:function(e){t.checktime=e},expression:"checktime"}}),t._v(" "),n("div",[n("a-button",{staticClass:"mgt",attrs:{type:"primary",ghost:""},on:{click:t.changeIpcasData}},[t._v("\n          Thay đổi IPCAS\n        ")])],1)],1),t._v(" "),n("a-col",{attrs:{md:5}},[n("a-upload",{attrs:{accept:".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",name:"file",multiple:!0,"file-list":t.fileList,"show-upload-list":t.uploadFileConfig,"before-upload":t.handleBeforeUpload}},[n("a-button",[n("a-icon",{attrs:{type:"upload"}}),t._v(" Chọn file glcb03 ")],1)],1)],1),t._v(" "),n("a-col",{attrs:{md:2}},[n("a-button",{key:"submit",attrs:{type:"danger"},on:{click:t.onDeleteAll}},[t._v("\n        Xoá tất cả\n      ")])],1)],1),t._v(" "),n("a-row",[n("a-col",{attrs:{md:12}},[n("h4",[t._v("\n        FIMI:\n        "),n("a-input-number",{staticStyle:{width:"35%"},attrs:{min:0,step:5e4,formatter:function(t){return(""+t).replace(/\B(?=(\d{3})+(?!\d))/g,",")}},on:{change:t.onChangeValue},model:{value:t.value.fimi,callback:function(e){t.$set(t.value,"fimi",e)},expression:"value.fimi"}})],1),t._v(" "),n("a-textarea",{attrs:{rows:5},model:{value:t.data.fimi,callback:function(e){t.$set(t.data,"fimi",e)},expression:"data.fimi"}})],1),t._v(" "),n("a-col",{attrs:{md:12}},[n("h4",[t._v("\n        IPCAS:\n        "),n("a-input-number",{staticStyle:{width:"35%"},attrs:{min:0,step:5e4,formatter:function(t){return(""+t).replace(/\B(?=(\d{3})+(?!\d))/g,",")}},on:{change:t.onChangeValue},model:{value:t.value.ipcas,callback:function(e){t.$set(t.value,"ipcas",e)},expression:"value.ipcas"}})],1),t._v(" "),n("a-textarea",{attrs:{disabled:!0,rows:5},model:{value:t.data.ipcas,callback:function(e){t.$set(t.data,"ipcas",e)},expression:"data.ipcas"}})],1)],1),t._v(" "),n("a-row",[n("a-col",{attrs:{md:8}},[n("a-card",{attrs:{title:"Chưa hạch toán"}},[n("a-tag",{attrs:{color:"blue"}},[t._v("\n          "+t._s(t.count.notAccounted)+"\n        ")]),t._v(" "),n("a-divider",{attrs:{type:"vertical"}}),t._v(" "),n("a-tag",{attrs:{color:"red"}},[t._v("\n          "+t._s(t.amount.notAccounted.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" đ")+"\n        ")])],1)],1),t._v(" "),n("a-col",{attrs:{md:8}},[n("a-card",{attrs:{title:"Đã hạch toán"}},[n("a-tag",{attrs:{color:"blue"}},[t._v("\n          "+t._s(t.count.accounted)+"\n        ")]),t._v(" "),n("a-divider",{attrs:{type:"vertical"}}),t._v(" "),n("a-tag",{attrs:{color:"red"}},[t._v("\n          "+t._s(t.amount.accounted.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" đ")+"\n        ")])],1)],1),t._v(" "),n("a-col",{attrs:{md:8}},[n("a-card",{attrs:{title:"Tổng"}},[n("a-tag",{attrs:{color:"blue"}},[t._v("\n          "+t._s(t.count.all)+"\n        ")]),t._v(" "),n("a-divider",{attrs:{type:"vertical"}}),t._v(" "),n("a-tag",{attrs:{color:"red"}},[t._v("\n          "+t._s(t.amount.all.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" đ")+"\n        ")])],1)],1)],1),t._v(" "),n("a-row",[n("a-col",{attrs:{md:24}},[n("a-table",{attrs:{columns:t.table.banknet.columns,"data-source":t.table.banknet.data,pagination:!1,"row-class-name":function(t){return(t.color?"row-color-accounted":"")+" "+(t.noStan?"row-color-no-stan":"")}},scopedSlots:t._u([{key:"key",fn:function(text){return n("a",{},[t._v(" "+t._s(text))])}},{key:"amount",fn:function(text,e){return[t._v("\n          "+t._s(e.amount.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","))+"\n        ")]}}])})],1)],1)],1)}),[],!1,null,null,null);e.default=component.exports}}]);